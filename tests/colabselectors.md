<div class="cell code notebook-cell code-has-output focused" id="cell-3oaaOZ04ozsP" role="region" aria-label="Ячейка 1. Ее тип: &quot;Кодовая ячейка&quot;. Название: &quot;&quot;." style="" tabindex="-1"><div class="cell-tag-editor sticky"></div><div class="agent-focus-label">
      <md-icon aria-hidden="true">spark</md-icon>
      <!--?lit$678368646$-->Gemini
    </div><div class="cell-toolbar sticky"><colab-cell-toolbar></colab-cell-toolbar></div><div class="main-content"><div class="cell-contents"><div class="cell-mask"></div><span class="imported-info-area"></span><div class="codecell-input-output">
      <div class="inputarea horizontal layout code">
        <div class="cell-gutter">
          <!-- Bounding range for vertical scrolling of icons -->
          <div class="cell-execution-container">
            <colab-run-button></colab-run-button>
          </div>
        </div>
      <div class="editor flex lazy-editor" style=""><div class="editor flex monaco" data-keybinding-context="7" data-mode-id="notebook-python" style="height: 4019px; --vscode-editorCodeLens-lineHeight: 16px; --vscode-editorCodeLens-fontSize: 12px; --vscode-editorCodeLens-fontFeatureSettings: &quot;liga&quot; off, &quot;calt&quot; off;"><div class="monaco-editor no-user-select  showUnused showDeprecated vs-dark" role="code" data-uri="inmemory://model/4" style="width: 603px; height: 4019px;"><div data-mprt="3" class="overflow-guard" style="width: 603px; height: 4019px; overflow: clip;"><div class="margin" role="presentation" aria-hidden="true" style="position: absolute; contain: strict; will-change: unset; top: 0px; height: 4019px; width: 6px;"><div class="glyph-margin" style="left: 0px; width: 0px; height: 4019px;"></div><div class="margin-view-zones" role="presentation" aria-hidden="true" style="position: absolute;"></div><div class="margin-view-overlays" role="presentation" aria-hidden="true" style="position: absolute; font-family: monospace, Consolas, &quot;Courier New&quot;, monospace; font-weight: normal; font-size: 14px; font-feature-settings: &quot;liga&quot; 0, &quot;calt&quot; 0; font-variation-settings: normal; line-height: 19px; letter-spacing: 0px; width: 6px; height: 4019px;"><div style="position:absolute;top:0px;width:100%;height:19px;"><div class="current-line current-line-margin-both" style="width:6px; height:19px;"></div></div><div style="position:absolute;top:19px;width:100%;height:19px;"></div><div style="position:absolute;top:38px;width:100%;height:19px;"></div><div style="position:absolute;top:57px;width:100%;height:19px;"></div><div style="position:absolute;top:76px;width:100%;height:19px;"></div><div style="position:absolute;top:95px;width:100%;height:19px;"></div><div style="position:absolute;top:114px;width:100%;height:19px;"></div><div style="position:absolute;top:133px;width:100%;height:19px;"></div><div style="position:absolute;top:152px;width:100%;height:19px;"></div><div style="position:absolute;top:171px;width:100%;height:19px;"></div><div style="position:absolute;top:190px;width:100%;height:19px;"></div><div style="position:absolute;top:209px;width:100%;height:19px;"></div><div style="position:absolute;top:228px;width:100%;height:19px;"></div><div style="position:absolute;top:247px;width:100%;height:19px;"></div><div style="position:absolute;top:266px;width:100%;height:19px;"></div><div style="position:absolute;top:285px;width:100%;height:19px;"></div><div style="position:absolute;top:304px;width:100%;height:19px;"></div><div style="position:absolute;top:323px;width:100%;height:19px;"></div><div style="position:absolute;top:342px;width:100%;height:19px;"></div><div style="position:absolute;top:361px;width:100%;height:19px;"></div><div style="position:absolute;top:380px;width:100%;height:19px;"></div><div style="position:absolute;top:399px;width:100%;height:19px;"></div><div style="position:absolute;top:418px;width:100%;height:19px;"></div><div style="position:absolute;top:437px;width:100%;height:19px;"></div><div style="position:absolute;top:456px;width:100%;height:19px;"></div><div style="position:absolute;top:475px;width:100%;height:19px;"></div><div style="position:absolute;top:494px;width:100%;height:19px;"></div><div style="position:absolute;top:513px;width:100%;height:19px;"></div><div style="position:absolute;top:532px;width:100%;height:19px;"></div><div style="position:absolute;top:551px;width:100%;height:19px;"></div><div style="position:absolute;top:570px;width:100%;height:19px;"></div><div style="position:absolute;top:589px;width:100%;height:19px;"></div><div style="position:absolute;top:608px;width:100%;height:19px;"></div><div style="position:absolute;top:627px;width:100%;height:19px;"></div><div style="position:absolute;top:646px;width:100%;height:19px;"></div><div style="position:absolute;top:665px;width:100%;height:19px;"></div><div style="position:absolute;top:684px;width:100%;height:19px;"></div><div style="position:absolute;top:703px;width:100%;height:19px;"></div><div style="position:absolute;top:722px;width:100%;height:19px;"></div><div style="position:absolute;top:741px;width:100%;height:19px;"></div><div style="position:absolute;top:760px;width:100%;height:19px;"></div><div style="position:absolute;top:779px;width:100%;height:19px;"></div><div style="position:absolute;top:798px;width:100%;height:19px;"></div><div style="position:absolute;top:817px;width:100%;height:19px;"></div><div style="position:absolute;top:836px;width:100%;height:19px;"></div><div style="position:absolute;top:855px;width:100%;height:19px;"></div><div style="position:absolute;top:874px;width:100%;height:19px;"></div><div style="position:absolute;top:893px;width:100%;height:19px;"></div><div style="position:absolute;top:912px;width:100%;height:19px;"></div><div style="position:absolute;top:931px;width:100%;height:19px;"></div><div style="position:absolute;top:950px;width:100%;height:19px;"></div><div style="position:absolute;top:969px;width:100%;height:19px;"></div><div style="position:absolute;top:988px;width:100%;height:19px;"></div><div style="position:absolute;top:1007px;width:100%;height:19px;"></div><div style="position:absolute;top:1026px;width:100%;height:19px;"></div><div style="position:absolute;top:1045px;width:100%;height:19px;"></div><div style="position:absolute;top:1064px;width:100%;height:19px;"></div><div style="position:absolute;top:1083px;width:100%;height:19px;"></div><div style="position:absolute;top:1102px;width:100%;height:19px;"></div><div style="position:absolute;top:1121px;width:100%;height:19px;"></div><div style="position:absolute;top:1140px;width:100%;height:19px;"></div><div style="position:absolute;top:1159px;width:100%;height:19px;"></div><div style="position:absolute;top:1178px;width:100%;height:19px;"></div><div style="position:absolute;top:1197px;width:100%;height:19px;"></div><div style="position:absolute;top:1216px;width:100%;height:19px;"></div><div style="position:absolute;top:1235px;width:100%;height:19px;"></div><div style="position:absolute;top:1254px;width:100%;height:19px;"></div><div style="position:absolute;top:1273px;width:100%;height:19px;"></div><div style="position:absolute;top:1292px;width:100%;height:19px;"></div><div style="position:absolute;top:1311px;width:100%;height:19px;"></div><div style="position:absolute;top:1330px;width:100%;height:19px;"></div><div style="position:absolute;top:1349px;width:100%;height:19px;"></div><div style="position:absolute;top:1368px;width:100%;height:19px;"></div><div style="position:absolute;top:1387px;width:100%;height:19px;"></div><div style="position:absolute;top:1406px;width:100%;height:19px;"></div><div style="position:absolute;top:1425px;width:100%;height:19px;"></div><div style="position:absolute;top:1444px;width:100%;height:19px;"></div><div style="position:absolute;top:1463px;width:100%;height:19px;"></div><div style="position:absolute;top:1482px;width:100%;height:19px;"></div><div style="position:absolute;top:1501px;width:100%;height:19px;"></div><div style="position:absolute;top:1520px;width:100%;height:19px;"></div><div style="position:absolute;top:1539px;width:100%;height:19px;"></div><div style="position:absolute;top:1558px;width:100%;height:19px;"></div><div style="position:absolute;top:1577px;width:100%;height:19px;"></div><div style="position:absolute;top:1596px;width:100%;height:19px;"></div><div style="position:absolute;top:1615px;width:100%;height:19px;"></div><div style="position:absolute;top:1634px;width:100%;height:19px;"></div><div style="position:absolute;top:1653px;width:100%;height:19px;"></div><div style="position:absolute;top:1672px;width:100%;height:19px;"></div><div style="position:absolute;top:1691px;width:100%;height:19px;"></div><div style="position:absolute;top:1710px;width:100%;height:19px;"></div><div style="position:absolute;top:1729px;width:100%;height:19px;"></div><div style="position:absolute;top:1748px;width:100%;height:19px;"></div><div style="position:absolute;top:1767px;width:100%;height:19px;"></div><div style="position:absolute;top:1786px;width:100%;height:19px;"></div><div style="position:absolute;top:1805px;width:100%;height:19px;"></div><div style="position:absolute;top:1824px;width:100%;height:19px;"></div><div style="position:absolute;top:1843px;width:100%;height:19px;"></div><div style="position:absolute;top:1862px;width:100%;height:19px;"></div><div style="position:absolute;top:1881px;width:100%;height:19px;"></div><div style="position:absolute;top:1900px;width:100%;height:19px;"></div><div style="position:absolute;top:1919px;width:100%;height:19px;"></div><div style="position:absolute;top:1938px;width:100%;height:19px;"></div><div style="position:absolute;top:1957px;width:100%;height:19px;"></div><div style="position:absolute;top:1976px;width:100%;height:19px;"></div><div style="position:absolute;top:1995px;width:100%;height:19px;"></div><div style="position:absolute;top:2014px;width:100%;height:19px;"></div><div style="position:absolute;top:2033px;width:100%;height:19px;"></div><div style="position:absolute;top:2052px;width:100%;height:19px;"></div><div style="position:absolute;top:2071px;width:100%;height:19px;"></div><div style="position:absolute;top:2090px;width:100%;height:19px;"></div><div style="position:absolute;top:2109px;width:100%;height:19px;"></div><div style="position:absolute;top:2128px;width:100%;height:19px;"></div><div style="position:absolute;top:2147px;width:100%;height:19px;"></div><div style="position:absolute;top:2166px;width:100%;height:19px;"></div><div style="position:absolute;top:2185px;width:100%;height:19px;"></div><div style="position:absolute;top:2204px;width:100%;height:19px;"></div><div style="position:absolute;top:2223px;width:100%;height:19px;"></div><div style="position:absolute;top:2242px;width:100%;height:19px;"></div><div style="position:absolute;top:2261px;width:100%;height:19px;"></div><div style="position:absolute;top:2280px;width:100%;height:19px;"></div><div style="position:absolute;top:2299px;width:100%;height:19px;"></div><div style="position:absolute;top:2318px;width:100%;height:19px;"></div><div style="position:absolute;top:2337px;width:100%;height:19px;"></div><div style="position:absolute;top:2356px;width:100%;height:19px;"></div><div style="position:absolute;top:2375px;width:100%;height:19px;"></div><div style="position:absolute;top:2394px;width:100%;height:19px;"></div><div style="position:absolute;top:2413px;width:100%;height:19px;"></div><div style="position:absolute;top:2432px;width:100%;height:19px;"></div><div style="position:absolute;top:2451px;width:100%;height:19px;"></div><div style="position:absolute;top:2470px;width:100%;height:19px;"></div><div style="position:absolute;top:2489px;width:100%;height:19px;"></div><div style="position:absolute;top:2508px;width:100%;height:19px;"></div><div style="position:absolute;top:2527px;width:100%;height:19px;"></div><div style="position:absolute;top:2546px;width:100%;height:19px;"></div><div style="position:absolute;top:2565px;width:100%;height:19px;"></div><div style="position:absolute;top:2584px;width:100%;height:19px;"></div><div style="position:absolute;top:2603px;width:100%;height:19px;"></div><div style="position:absolute;top:2622px;width:100%;height:19px;"></div><div style="position:absolute;top:2641px;width:100%;height:19px;"></div><div style="position:absolute;top:2660px;width:100%;height:19px;"></div><div style="position:absolute;top:2679px;width:100%;height:19px;"></div><div style="position:absolute;top:2698px;width:100%;height:19px;"></div><div style="position:absolute;top:2717px;width:100%;height:19px;"></div><div style="position:absolute;top:2736px;width:100%;height:19px;"></div><div style="position:absolute;top:2755px;width:100%;height:19px;"></div><div style="position:absolute;top:2774px;width:100%;height:19px;"></div><div style="position:absolute;top:2793px;width:100%;height:19px;"></div><div style="position:absolute;top:2812px;width:100%;height:19px;"></div><div style="position:absolute;top:2831px;width:100%;height:19px;"></div><div style="position:absolute;top:2850px;width:100%;height:19px;"></div><div style="position:absolute;top:2869px;width:100%;height:19px;"></div><div style="position:absolute;top:2888px;width:100%;height:19px;"></div><div style="position:absolute;top:2907px;width:100%;height:19px;"></div><div style="position:absolute;top:2926px;width:100%;height:19px;"></div><div style="position:absolute;top:2945px;width:100%;height:19px;"></div><div style="position:absolute;top:2964px;width:100%;height:19px;"></div><div style="position:absolute;top:2983px;width:100%;height:19px;"></div><div style="position:absolute;top:3002px;width:100%;height:19px;"></div><div style="position:absolute;top:3021px;width:100%;height:19px;"></div><div style="position:absolute;top:3040px;width:100%;height:19px;"></div><div style="position:absolute;top:3059px;width:100%;height:19px;"></div><div style="position:absolute;top:3078px;width:100%;height:19px;"></div><div style="position:absolute;top:3097px;width:100%;height:19px;"></div><div style="position:absolute;top:3116px;width:100%;height:19px;"></div><div style="position:absolute;top:3135px;width:100%;height:19px;"></div><div style="position:absolute;top:3154px;width:100%;height:19px;"></div><div style="position:absolute;top:3173px;width:100%;height:19px;"></div><div style="position:absolute;top:3192px;width:100%;height:19px;"></div><div style="position:absolute;top:3211px;width:100%;height:19px;"></div><div style="position:absolute;top:3230px;width:100%;height:19px;"></div><div style="position:absolute;top:3249px;width:100%;height:19px;"></div><div style="position:absolute;top:3268px;width:100%;height:19px;"></div><div style="position:absolute;top:3287px;width:100%;height:19px;"></div><div style="position:absolute;top:3306px;width:100%;height:19px;"></div><div style="position:absolute;top:3325px;width:100%;height:19px;"></div><div style="position:absolute;top:3344px;width:100%;height:19px;"></div><div style="position:absolute;top:3363px;width:100%;height:19px;"></div><div style="position:absolute;top:3382px;width:100%;height:19px;"></div><div style="position:absolute;top:3401px;width:100%;height:19px;"></div><div style="position:absolute;top:3420px;width:100%;height:19px;"></div><div style="position:absolute;top:3439px;width:100%;height:19px;"></div><div style="position:absolute;top:3458px;width:100%;height:19px;"></div><div style="position:absolute;top:3477px;width:100%;height:19px;"></div><div style="position:absolute;top:3496px;width:100%;height:19px;"></div><div style="position:absolute;top:3515px;width:100%;height:19px;"></div><div style="position:absolute;top:3534px;width:100%;height:19px;"></div><div style="position:absolute;top:3553px;width:100%;height:19px;"></div><div style="position:absolute;top:3572px;width:100%;height:19px;"></div><div style="position:absolute;top:3591px;width:100%;height:19px;"></div><div style="position:absolute;top:3610px;width:100%;height:19px;"></div><div style="position:absolute;top:3629px;width:100%;height:19px;"></div><div style="position:absolute;top:3648px;width:100%;height:19px;"></div><div style="position:absolute;top:3667px;width:100%;height:19px;"></div><div style="position:absolute;top:3686px;width:100%;height:19px;"></div><div style="position:absolute;top:3705px;width:100%;height:19px;"></div><div style="position:absolute;top:3724px;width:100%;height:19px;"></div><div style="position:absolute;top:3743px;width:100%;height:19px;"></div><div style="position:absolute;top:3762px;width:100%;height:19px;"></div><div style="position:absolute;top:3781px;width:100%;height:19px;"></div><div style="position:absolute;top:3800px;width:100%;height:19px;"></div><div style="position:absolute;top:3819px;width:100%;height:19px;"></div><div style="position:absolute;top:3838px;width:100%;height:19px;"></div><div style="position:absolute;top:3857px;width:100%;height:19px;"></div><div style="position:absolute;top:3876px;width:100%;height:19px;"></div><div style="position:absolute;top:3895px;width:100%;height:19px;"></div><div style="position:absolute;top:3914px;width:100%;height:19px;"></div><div style="position:absolute;top:3933px;width:100%;height:19px;"></div><div style="position:absolute;top:3952px;width:100%;height:19px;"></div><div style="position:absolute;top:3971px;width:100%;height:19px;"></div><div style="position:absolute;top:3990px;width:100%;height:19px;"></div></div><div class="glyph-margin-widgets" style="position: absolute; top: 0px;"></div></div><div class="monaco-scrollable-element editor-scrollable vs-dark" role="presentation" data-mprt="5" style="position: absolute; overflow: hidden; left: 6px; width: 597px; height: 4019px;"><div class="lines-content monaco-editor-background" style="position: absolute; overflow: hidden; width: 1e+06px; height: 4019px; contain: strict; will-change: unset; top: 0px; left: -1px;"><div class="view-overlays" role="presentation" aria-hidden="true" style="position: absolute; font-family: monospace, Consolas, &quot;Courier New&quot;, monospace; font-weight: normal; font-size: 14px; font-feature-settings: &quot;liga&quot; 0, &quot;calt&quot; 0; font-variation-settings: normal; line-height: 19px; letter-spacing: 0px; height: 0px; width: 1299px;"><div style="position:absolute;top:0px;width:100%;height:19px;"><div class="current-line" style="width:1299px; height:19px;"></div></div><div style="position:absolute;top:19px;width:100%;height:19px;"></div><div style="position:absolute;top:38px;width:100%;height:19px;"></div><div style="position:absolute;top:57px;width:100%;height:19px;"></div><div style="position:absolute;top:76px;width:100%;height:19px;"></div><div style="position:absolute;top:95px;width:100%;height:19px;"></div><div style="position:absolute;top:114px;width:100%;height:19px;"></div><div style="position:absolute;top:133px;width:100%;height:19px;"></div><div style="position:absolute;top:152px;width:100%;height:19px;"></div><div style="position:absolute;top:171px;width:100%;height:19px;"></div><div style="position:absolute;top:190px;width:100%;height:19px;"></div><div style="position:absolute;top:209px;width:100%;height:19px;"></div><div style="position:absolute;top:228px;width:100%;height:19px;"></div><div style="position:absolute;top:247px;width:100%;height:19px;"></div><div style="position:absolute;top:266px;width:100%;height:19px;"></div><div style="position:absolute;top:285px;width:100%;height:19px;"></div><div style="position:absolute;top:304px;width:100%;height:19px;"></div><div style="position:absolute;top:323px;width:100%;height:19px;"></div><div style="position:absolute;top:342px;width:100%;height:19px;"></div><div style="position:absolute;top:361px;width:100%;height:19px;"></div><div style="position:absolute;top:380px;width:100%;height:19px;"></div><div style="position:absolute;top:399px;width:100%;height:19px;"></div><div style="position:absolute;top:418px;width:100%;height:19px;"></div><div style="position:absolute;top:437px;width:100%;height:19px;"></div><div style="position:absolute;top:456px;width:100%;height:19px;"></div><div style="position:absolute;top:475px;width:100%;height:19px;"></div><div style="position:absolute;top:494px;width:100%;height:19px;"></div><div style="position:absolute;top:513px;width:100%;height:19px;"></div><div style="position:absolute;top:532px;width:100%;height:19px;"></div><div style="position:absolute;top:551px;width:100%;height:19px;"></div><div style="position:absolute;top:570px;width:100%;height:19px;"></div><div style="position:absolute;top:589px;width:100%;height:19px;"></div><div style="position:absolute;top:608px;width:100%;height:19px;"></div><div style="position:absolute;top:627px;width:100%;height:19px;"></div><div style="position:absolute;top:646px;width:100%;height:19px;"></div><div style="position:absolute;top:665px;width:100%;height:19px;"></div><div style="position:absolute;top:684px;width:100%;height:19px;"></div><div style="position:absolute;top:703px;width:100%;height:19px;"></div><div style="position:absolute;top:722px;width:100%;height:19px;"></div><div style="position:absolute;top:741px;width:100%;height:19px;"></div><div style="position:absolute;top:760px;width:100%;height:19px;"></div><div style="position:absolute;top:779px;width:100%;height:19px;"></div><div style="position:absolute;top:798px;width:100%;height:19px;"></div><div style="position:absolute;top:817px;width:100%;height:19px;"></div><div style="position:absolute;top:836px;width:100%;height:19px;"></div><div style="position:absolute;top:855px;width:100%;height:19px;"></div><div style="position:absolute;top:874px;width:100%;height:19px;"></div><div style="position:absolute;top:893px;width:100%;height:19px;"></div><div style="position:absolute;top:912px;width:100%;height:19px;"></div><div style="position:absolute;top:931px;width:100%;height:19px;"></div><div style="position:absolute;top:950px;width:100%;height:19px;"></div><div style="position:absolute;top:969px;width:100%;height:19px;"></div><div style="position:absolute;top:988px;width:100%;height:19px;"></div><div style="position:absolute;top:1007px;width:100%;height:19px;"></div><div style="position:absolute;top:1026px;width:100%;height:19px;"></div><div style="position:absolute;top:1045px;width:100%;height:19px;"></div><div style="position:absolute;top:1064px;width:100%;height:19px;"></div><div style="position:absolute;top:1083px;width:100%;height:19px;"></div><div style="position:absolute;top:1102px;width:100%;height:19px;"></div><div style="position:absolute;top:1121px;width:100%;height:19px;"></div><div style="position:absolute;top:1140px;width:100%;height:19px;"></div><div style="position:absolute;top:1159px;width:100%;height:19px;"></div><div style="position:absolute;top:1178px;width:100%;height:19px;"></div><div style="position:absolute;top:1197px;width:100%;height:19px;"></div><div style="position:absolute;top:1216px;width:100%;height:19px;"></div><div style="position:absolute;top:1235px;width:100%;height:19px;"></div><div style="position:absolute;top:1254px;width:100%;height:19px;"></div><div style="position:absolute;top:1273px;width:100%;height:19px;"></div><div style="position:absolute;top:1292px;width:100%;height:19px;"></div><div style="position:absolute;top:1311px;width:100%;height:19px;"></div><div style="position:absolute;top:1330px;width:100%;height:19px;"></div><div style="position:absolute;top:1349px;width:100%;height:19px;"></div><div style="position:absolute;top:1368px;width:100%;height:19px;"></div><div style="position:absolute;top:1387px;width:100%;height:19px;"></div><div style="position:absolute;top:1406px;width:100%;height:19px;"></div><div style="position:absolute;top:1425px;width:100%;height:19px;"></div><div style="position:absolute;top:1444px;width:100%;height:19px;"></div><div style="position:absolute;top:1463px;width:100%;height:19px;"></div><div style="position:absolute;top:1482px;width:100%;height:19px;"></div><div style="position:absolute;top:1501px;width:100%;height:19px;"></div><div style="position:absolute;top:1520px;width:100%;height:19px;"></div><div style="position:absolute;top:1539px;width:100%;height:19px;"></div><div style="position:absolute;top:1558px;width:100%;height:19px;"></div><div style="position:absolute;top:1577px;width:100%;height:19px;"></div><div style="position:absolute;top:1596px;width:100%;height:19px;"></div><div style="position:absolute;top:1615px;width:100%;height:19px;"></div><div style="position:absolute;top:1634px;width:100%;height:19px;"></div><div style="position:absolute;top:1653px;width:100%;height:19px;"></div><div style="position:absolute;top:1672px;width:100%;height:19px;"></div><div style="position:absolute;top:1691px;width:100%;height:19px;"></div><div style="position:absolute;top:1710px;width:100%;height:19px;"></div><div style="position:absolute;top:1729px;width:100%;height:19px;"></div><div style="position:absolute;top:1748px;width:100%;height:19px;"></div><div style="position:absolute;top:1767px;width:100%;height:19px;"></div><div style="position:absolute;top:1786px;width:100%;height:19px;"></div><div style="position:absolute;top:1805px;width:100%;height:19px;"></div><div style="position:absolute;top:1824px;width:100%;height:19px;"></div><div style="position:absolute;top:1843px;width:100%;height:19px;"></div><div style="position:absolute;top:1862px;width:100%;height:19px;"></div><div style="position:absolute;top:1881px;width:100%;height:19px;"></div><div style="position:absolute;top:1900px;width:100%;height:19px;"></div><div style="position:absolute;top:1919px;width:100%;height:19px;"></div><div style="position:absolute;top:1938px;width:100%;height:19px;"></div><div style="position:absolute;top:1957px;width:100%;height:19px;"></div><div style="position:absolute;top:1976px;width:100%;height:19px;"></div><div style="position:absolute;top:1995px;width:100%;height:19px;"></div><div style="position:absolute;top:2014px;width:100%;height:19px;"></div><div style="position:absolute;top:2033px;width:100%;height:19px;"></div><div style="position:absolute;top:2052px;width:100%;height:19px;"></div><div style="position:absolute;top:2071px;width:100%;height:19px;"></div><div style="position:absolute;top:2090px;width:100%;height:19px;"></div><div style="position:absolute;top:2109px;width:100%;height:19px;"></div><div style="position:absolute;top:2128px;width:100%;height:19px;"></div><div style="position:absolute;top:2147px;width:100%;height:19px;"></div><div style="position:absolute;top:2166px;width:100%;height:19px;"></div><div style="position:absolute;top:2185px;width:100%;height:19px;"></div><div style="position:absolute;top:2204px;width:100%;height:19px;"></div><div style="position:absolute;top:2223px;width:100%;height:19px;"></div><div style="position:absolute;top:2242px;width:100%;height:19px;"></div><div style="position:absolute;top:2261px;width:100%;height:19px;"></div><div style="position:absolute;top:2280px;width:100%;height:19px;"></div><div style="position:absolute;top:2299px;width:100%;height:19px;"></div><div style="position:absolute;top:2318px;width:100%;height:19px;"></div><div style="position:absolute;top:2337px;width:100%;height:19px;"></div><div style="position:absolute;top:2356px;width:100%;height:19px;"></div><div style="position:absolute;top:2375px;width:100%;height:19px;"></div><div style="position:absolute;top:2394px;width:100%;height:19px;"></div><div style="position:absolute;top:2413px;width:100%;height:19px;"></div><div style="position:absolute;top:2432px;width:100%;height:19px;"></div><div style="position:absolute;top:2451px;width:100%;height:19px;"></div><div style="position:absolute;top:2470px;width:100%;height:19px;"></div><div style="position:absolute;top:2489px;width:100%;height:19px;"></div><div style="position:absolute;top:2508px;width:100%;height:19px;"></div><div style="position:absolute;top:2527px;width:100%;height:19px;"></div><div style="position:absolute;top:2546px;width:100%;height:19px;"></div><div style="position:absolute;top:2565px;width:100%;height:19px;"></div><div style="position:absolute;top:2584px;width:100%;height:19px;"></div><div style="position:absolute;top:2603px;width:100%;height:19px;"></div><div style="position:absolute;top:2622px;width:100%;height:19px;"></div><div style="position:absolute;top:2641px;width:100%;height:19px;"></div><div style="position:absolute;top:2660px;width:100%;height:19px;"></div><div style="position:absolute;top:2679px;width:100%;height:19px;"></div><div style="position:absolute;top:2698px;width:100%;height:19px;"></div><div style="position:absolute;top:2717px;width:100%;height:19px;"></div><div style="position:absolute;top:2736px;width:100%;height:19px;"></div><div style="position:absolute;top:2755px;width:100%;height:19px;"></div><div style="position:absolute;top:2774px;width:100%;height:19px;"></div><div style="position:absolute;top:2793px;width:100%;height:19px;"></div><div style="position:absolute;top:2812px;width:100%;height:19px;"></div><div style="position:absolute;top:2831px;width:100%;height:19px;"></div><div style="position:absolute;top:2850px;width:100%;height:19px;"></div><div style="position:absolute;top:2869px;width:100%;height:19px;"></div><div style="position:absolute;top:2888px;width:100%;height:19px;"></div><div style="position:absolute;top:2907px;width:100%;height:19px;"></div><div style="position:absolute;top:2926px;width:100%;height:19px;"></div><div style="position:absolute;top:2945px;width:100%;height:19px;"></div><div style="position:absolute;top:2964px;width:100%;height:19px;"></div><div style="position:absolute;top:2983px;width:100%;height:19px;"></div><div style="position:absolute;top:3002px;width:100%;height:19px;"></div><div style="position:absolute;top:3021px;width:100%;height:19px;"></div><div style="position:absolute;top:3040px;width:100%;height:19px;"></div><div style="position:absolute;top:3059px;width:100%;height:19px;"></div><div style="position:absolute;top:3078px;width:100%;height:19px;"></div><div style="position:absolute;top:3097px;width:100%;height:19px;"></div><div style="position:absolute;top:3116px;width:100%;height:19px;"></div><div style="position:absolute;top:3135px;width:100%;height:19px;"></div><div style="position:absolute;top:3154px;width:100%;height:19px;"></div><div style="position:absolute;top:3173px;width:100%;height:19px;"></div><div style="position:absolute;top:3192px;width:100%;height:19px;"></div><div style="position:absolute;top:3211px;width:100%;height:19px;"></div><div style="position:absolute;top:3230px;width:100%;height:19px;"></div><div style="position:absolute;top:3249px;width:100%;height:19px;"></div><div style="position:absolute;top:3268px;width:100%;height:19px;"></div><div style="position:absolute;top:3287px;width:100%;height:19px;"></div><div style="position:absolute;top:3306px;width:100%;height:19px;"></div><div style="position:absolute;top:3325px;width:100%;height:19px;"></div><div style="position:absolute;top:3344px;width:100%;height:19px;"></div><div style="position:absolute;top:3363px;width:100%;height:19px;"></div><div style="position:absolute;top:3382px;width:100%;height:19px;"></div><div style="position:absolute;top:3401px;width:100%;height:19px;"></div><div style="position:absolute;top:3420px;width:100%;height:19px;"></div><div style="position:absolute;top:3439px;width:100%;height:19px;"></div><div style="position:absolute;top:3458px;width:100%;height:19px;"></div><div style="position:absolute;top:3477px;width:100%;height:19px;"></div><div style="position:absolute;top:3496px;width:100%;height:19px;"></div><div style="position:absolute;top:3515px;width:100%;height:19px;"></div><div style="position:absolute;top:3534px;width:100%;height:19px;"></div><div style="position:absolute;top:3553px;width:100%;height:19px;"></div><div style="position:absolute;top:3572px;width:100%;height:19px;"></div><div style="position:absolute;top:3591px;width:100%;height:19px;"></div><div style="position:absolute;top:3610px;width:100%;height:19px;"></div><div style="position:absolute;top:3629px;width:100%;height:19px;"></div><div style="position:absolute;top:3648px;width:100%;height:19px;"></div><div style="position:absolute;top:3667px;width:100%;height:19px;"></div><div style="position:absolute;top:3686px;width:100%;height:19px;"></div><div style="position:absolute;top:3705px;width:100%;height:19px;"></div><div style="position:absolute;top:3724px;width:100%;height:19px;"></div><div style="position:absolute;top:3743px;width:100%;height:19px;"></div><div style="position:absolute;top:3762px;width:100%;height:19px;"></div><div style="position:absolute;top:3781px;width:100%;height:19px;"></div><div style="position:absolute;top:3800px;width:100%;height:19px;"></div><div style="position:absolute;top:3819px;width:100%;height:19px;"></div><div style="position:absolute;top:3838px;width:100%;height:19px;"></div><div style="position:absolute;top:3857px;width:100%;height:19px;"></div><div style="position:absolute;top:3876px;width:100%;height:19px;"></div><div style="position:absolute;top:3895px;width:100%;height:19px;"></div><div style="position:absolute;top:3914px;width:100%;height:19px;"></div><div style="position:absolute;top:3933px;width:100%;height:19px;"></div><div style="position:absolute;top:3952px;width:100%;height:19px;"></div><div style="position:absolute;top:3971px;width:100%;height:19px;"></div><div style="position:absolute;top:3990px;width:100%;height:19px;"></div></div><div role="presentation" aria-hidden="true" class="view-rulers"><div class="view-ruler" style="width: 2px; height: 4019px; left: 615.938px;"></div></div><div class="view-zones" role="presentation" aria-hidden="true" style="position: absolute;"></div><div class="view-lines monaco-mouse-cursor-text" role="presentation" aria-hidden="true" data-mprt="7" style="position: absolute; font-family: monospace, Consolas, &quot;Courier New&quot;, monospace; font-weight: normal; font-size: 14px; font-feature-settings: &quot;liga&quot; 0, &quot;calt&quot; 0; font-variation-settings: normal; line-height: 19px; letter-spacing: 0px; width: 1299px; height: 4019px;"><div style="top:0px;height:19px;" class="view-line"><span><span class="mtk8">#!/usr/bin/env&nbsp;python3</span></span></div><div style="top:19px;height:19px;" class="view-line"><span><span class="mtk8">#&nbsp;-*-&nbsp;coding:&nbsp;utf-8&nbsp;-*-</span></span></div><div style="top:38px;height:19px;" class="view-line"><span><span class="mtk5">"""</span></span></div><div style="top:57px;height:19px;" class="view-line"><span><span class="mtk5">(DEBUG)&nbsp;Скрипт-воркер&nbsp;для&nbsp;Google&nbsp;Colab&nbsp;для&nbsp;</span><span class="mtk5">выполнения&nbsp;ОДНОЙ&nbsp;задачи.</span></span></div><div style="top:76px;height:19px;" class="view-line"><span><span class="mtk5">"""</span></span></div><div style="top:95px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:114px;height:19px;" class="view-line"><span><span class="mtk20">import</span><span class="mtk1">&nbsp;requests</span></span></div><div style="top:133px;height:19px;" class="view-line"><span><span class="mtk20">import</span><span class="mtk1">&nbsp;os</span></span></div><div style="top:152px;height:19px;" class="view-line"><span><span class="mtk20">import</span><span class="mtk1">&nbsp;time</span></span></div><div style="top:171px;height:19px;" class="view-line"><span><span class="mtk20">import</span><span class="mtk1">&nbsp;logging</span></span></div><div style="top:190px;height:19px;" class="view-line"><span><span class="mtk20">import</span><span class="mtk1">&nbsp;sys</span></span></div><div style="top:209px;height:19px;" class="view-line"><span><span class="mtk20">import</span><span class="mtk1">&nbsp;json&nbsp;</span><span class="mtk8">#&nbsp;Добавляем&nbsp;импорт&nbsp;json</span></span></div><div style="top:228px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:247px;height:19px;" class="view-line"><span><span class="mtk20">import</span><span class="mtk1">&nbsp;http.client</span></span></div><div style="top:266px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:285px;height:19px;" class="view-line"><span><span class="mtk8">#&nbsp;---&nbsp;Настройка&nbsp;---</span></span></div><div style="top:304px;height:19px;" class="view-line"><span><span class="mtk1">SERVER_URL&nbsp;=&nbsp;</span><span class="mtk5">"</span><span class="mtk5 detected-link">https://52d06bb05cd3.ngrok-free.app</span><span class="mtk5">"</span></span></div><div style="top:323px;height:19px;" class="view-line"><span><span class="mtk1">MODEL_NAME&nbsp;=&nbsp;</span><span class="mtk5">"medium"</span></span></div><div style="top:342px;height:19px;" class="view-line"><span><span class="mtk8">#&nbsp;---&nbsp;Конец&nbsp;настройки&nbsp;---</span></span></div><div style="top:361px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:380px;height:19px;" class="view-line"><span><span class="mtk8">#&nbsp;Настройка&nbsp;логирования&nbsp;с&nbsp;принудительным&nbsp;выводом</span></span></div><div style="top:399px;height:19px;" class="view-line"><span><span class="mtk1">logging.basicConfig</span><span class="mtk14 bracket-highlighting-0">(</span></span></div><div style="top:418px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;level=logging.INFO</span><span class="mtk14">,</span></span></div><div style="top:437px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;format=</span><span class="mtk5">'%(asctime)s&nbsp;-&nbsp;%(levelname)s&nbsp;-&nbsp;%(message)s'</span><span class="mtk14">,</span></span></div><div style="top:456px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;stream=sys.stdout&nbsp;&nbsp;</span><span class="mtk8">#&nbsp;Явно&nbsp;указываем&nbsp;поток&nbsp;вывода</span></span></div><div style="top:475px;height:19px;" class="view-line"><span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:494px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:513px;height:19px;" class="view-line"><span><span class="mtk10">def</span><span class="mtk1">&nbsp;</span><span class="mtk17">force_print</span><span class="mtk1 bracket-highlighting-0">(</span><span class="mtk4">message</span><span class="mtk1 bracket-highlighting-0">)</span><span class="mtk14">:</span></span></div><div style="top:532px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk5">"""Функция&nbsp;для&nbsp;вывода&nbsp;сообщений&nbsp;с&nbsp;принудительной&nbsp;</span><span class="mtk5">очисткой&nbsp;буфера."""</span></span></div><div style="top:551px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk17">print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">message</span><span class="mtk14">,</span><span class="mtk1">&nbsp;flush=</span><span class="mtk9">True</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:570px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:589px;height:19px;" class="view-line"><span><span class="mtk10">def</span><span class="mtk1">&nbsp;</span><span class="mtk17">setup_whisper</span><span class="mtk1 bracket-highlighting-0">(</span><span class="mtk1 bracket-highlighting-0">)</span><span class="mtk14">:</span></span></div><div style="top:608px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"--&gt;&nbsp;Этап&nbsp;1:&nbsp;Настройка&nbsp;Whisper..."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:627px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">try</span><span class="mtk14">:</span></span></div><div style="top:646px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">import</span><span class="mtk1">&nbsp;whisper</span></span></div><div style="top:665px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;Whisper&nbsp;уже&nbsp;импортирован."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:684px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">except</span><span class="mtk1">&nbsp;ImportError</span><span class="mtk14">:</span></span></div><div style="top:703px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;Установка&nbsp;зависимостей:&nbsp;openai-whisper,&nbsp;</span><span class="mtk5">requests..."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:722px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.system</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"pip&nbsp;install&nbsp;-q&nbsp;openai-whisper&nbsp;requests"</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:741px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.sleep</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk6">5</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:760px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">try</span><span class="mtk14">:</span></span></div><div style="top:779px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">import</span><span class="mtk1">&nbsp;whisper</span></span></div><div style="top:798px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;Зависимости&nbsp;успешно&nbsp;установлены."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:817px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">except</span><span class="mtk1">&nbsp;ImportError</span><span class="mtk14">:</span></span></div><div style="top:836px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;КРИТИЧЕСКАЯ&nbsp;ОШИБКА:&nbsp;Не&nbsp;удалось&nbsp;</span><span class="mtk5">установить/импортировать&nbsp;whisper."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:855px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span><span class="mtk1">&nbsp;</span><span class="mtk9">None</span></span></div><div style="top:874px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:893px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;Загрузка&nbsp;модели&nbsp;Whisper&nbsp;'</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">MODEL_NAME</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">'..."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:912px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">try</span><span class="mtk14">:</span></span></div><div style="top:931px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;model&nbsp;=&nbsp;whisper.load_model</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">MODEL_NAME</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:950px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;Модель&nbsp;Whisper&nbsp;успешно&nbsp;загружена!"</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:969px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span><span class="mtk1">&nbsp;model</span></span></div><div style="top:988px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">except</span><span class="mtk1">&nbsp;Exception&nbsp;</span><span class="mtk20">as</span><span class="mtk1">&nbsp;e</span><span class="mtk14">:</span></span></div><div style="top:1007px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;КРИТИЧЕСКАЯ&nbsp;ОШИБКА:&nbsp;Не&nbsp;удалось&nbsp;загрузить&nbsp;</span><span class="mtk5">модель&nbsp;Whisper:&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">e</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">"</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1026px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span><span class="mtk1">&nbsp;</span><span class="mtk9">None</span></span></div><div style="top:1045px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:1064px;height:19px;" class="view-line"><span><span class="mtk10">def</span><span class="mtk1">&nbsp;</span><span class="mtk17">get_task</span><span class="mtk1 bracket-highlighting-0">(</span><span class="mtk1 bracket-highlighting-0">)</span><span class="mtk14">:</span></span></div><div style="top:1083px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"--&gt;&nbsp;Этап&nbsp;2:&nbsp;Поиск&nbsp;задачи&nbsp;на&nbsp;сервере..."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1102px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">try</span><span class="mtk14">:</span></span></div><div style="top:1121px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;=&nbsp;</span><span class="mtk10">f</span><span class="mtk5">"</span><span class="mtk14 bracket-highlighting-0">{</span><span class="mtk1">SERVER_URL</span><span class="mtk14 bracket-highlighting-0">}</span><span class="mtk5">/api/colab/next-task"</span></span></div><div style="top:1140px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response&nbsp;=&nbsp;requests.get</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">url</span><span class="mtk14">,</span><span class="mtk1">&nbsp;timeout=</span><span class="mtk6">20</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1159px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">if</span><span class="mtk1">&nbsp;response.status_code&nbsp;==&nbsp;</span><span class="mtk6">200</span><span class="mtk14">:</span></span></div><div style="top:1178px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;Задача&nbsp;найдена!"</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1197px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span><span class="mtk1">&nbsp;response.json</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1216px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">elif</span><span class="mtk1">&nbsp;response.status_code&nbsp;==&nbsp;</span><span class="mtk6">404</span><span class="mtk14">:</span></span></div><div style="top:1235px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;Нет&nbsp;активных&nbsp;задач&nbsp;для&nbsp;транскрибации."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1254px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span><span class="mtk1">&nbsp;</span><span class="mtk9">None</span></span></div><div style="top:1273px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">else</span><span class="mtk14">:</span></span></div><div style="top:1292px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;ОШИБКА:&nbsp;Сервер&nbsp;ответил&nbsp;с&nbsp;кодом&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">response.status_code</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">&nbsp;-&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">response.text</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">"</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1311px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span><span class="mtk1">&nbsp;</span><span class="mtk9">None</span></span></div><div style="top:1330px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">except</span><span class="mtk1">&nbsp;requests.exceptions.RequestException&nbsp;</span><span class="mtk20">as</span><span class="mtk1">&nbsp;e</span><span class="mtk14">:</span></span></div><div style="top:1349px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;КРИТИЧЕСКАЯ&nbsp;ОШИБКА:&nbsp;Не&nbsp;удалось&nbsp;подключиться&nbsp;к&nbsp;</span><span class="mtk5">серверу&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">SERVER_URL</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">.&nbsp;Проверьте&nbsp;URL.&nbsp;Ошибка:&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">e</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">"</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1368px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span><span class="mtk1">&nbsp;</span><span class="mtk9">None</span></span></div><div style="top:1387px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:1406px;height:19px;" class="view-line"><span><span class="mtk10">def</span><span class="mtk1">&nbsp;</span><span class="mtk17">download_audio</span><span class="mtk1 bracket-highlighting-0">(</span><span class="mtk4">task_id</span><span class="mtk1">,&nbsp;</span><span class="mtk4">audio_url</span><span class="mtk1">,&nbsp;</span><span class="mtk4">filename</span><span class="mtk1">,&nbsp;</span><span class="mtk4">retries</span><span class="mtk1">=</span><span class="mtk6">3</span><span class="mtk1">,&nbsp;</span><span class="mtk4">delay</span><span class="mtk1">=</span><span class="mtk6">5</span><span class="mtk1 bracket-highlighting-0">)</span><span class="mtk14">:</span></span></div><div style="top:1425px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk5">"""Скачивает&nbsp;аудиофайл&nbsp;с&nbsp;логикой&nbsp;повторных&nbsp;попыток&nbsp;</span><span class="mtk5">и&nbsp;индикатором&nbsp;прогресса."""</span></span></div><div style="top:1444px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">for</span><span class="mtk1">&nbsp;attempt&nbsp;</span><span class="mtk19">in</span><span class="mtk1">&nbsp;</span><span class="mtk17">range</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">retries</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk14">:</span></span></div><div style="top:1463px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">try</span><span class="mtk14">:</span></span></div><div style="top:1482px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"[</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">task_id</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">]&nbsp;Попытка&nbsp;скачивания&nbsp;#</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">attempt&nbsp;+&nbsp;</span><span class="mtk6">1</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">/</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">retries</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">&nbsp;из&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">audio_url</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">..."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1501px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response&nbsp;=&nbsp;requests.get</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">audio_url</span><span class="mtk14">,</span><span class="mtk1">&nbsp;stream=</span><span class="mtk9">True</span><span class="mtk14">,</span><span class="mtk1">&nbsp;timeout=</span><span class="mtk6">120</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1520px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.raise_for_status</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1539px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:1558px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total_size&nbsp;=&nbsp;</span><span class="mtk16">int</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">response.headers.get</span><span class="mtk14 bracket-highlighting-1">(</span><span class="mtk5">'content-length'</span><span class="mtk14">,</span><span class="mtk1">&nbsp;</span><span class="mtk6">0</span><span class="mtk14 bracket-highlighting-1">)</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1577px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;downloaded_size&nbsp;=&nbsp;</span><span class="mtk6">0</span></span></div><div style="top:1596px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;downloaded_size_at_last_print&nbsp;=&nbsp;</span><span class="mtk6">0</span><span class="mtk1">&nbsp;</span><span class="mtk8">#&nbsp;Инициализируем&nbsp;переменную</span></span></div><div style="top:1615px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_time&nbsp;=&nbsp;time.time</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1634px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:1653px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">with</span><span class="mtk1">&nbsp;</span><span class="mtk17">open</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">filename</span><span class="mtk14">,</span><span class="mtk1">&nbsp;</span><span class="mtk5">'wb'</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk1">&nbsp;</span><span class="mtk20">as</span><span class="mtk1">&nbsp;f</span><span class="mtk14">:</span></span></div><div style="top:1672px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">for</span><span class="mtk1">&nbsp;chunk&nbsp;</span><span class="mtk19">in</span><span class="mtk1">&nbsp;response.iter_content</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">chunk_size=</span><span class="mtk6">8192</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk14">:</span></span></div><div style="top:1691px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">if</span><span class="mtk1">&nbsp;chunk</span><span class="mtk14">:</span></span></div><div style="top:1710px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">chunk</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1729px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;downloaded_size&nbsp;+=&nbsp;</span><span class="mtk17">len</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">chunk</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1748px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:1767px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk8">#&nbsp;Вывод&nbsp;прогресса</span></span></div><div style="top:1786px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">if</span><span class="mtk1">&nbsp;total_size&nbsp;&gt;&nbsp;</span><span class="mtk6">0</span><span class="mtk14">:</span></span></div><div style="top:1805px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;progress&nbsp;=&nbsp;</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">downloaded_size&nbsp;/&nbsp;total_size</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk1">&nbsp;*&nbsp;</span><span class="mtk6">100</span></span></div><div style="top:1824px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elapsed_time&nbsp;=&nbsp;time.ti</span><span class="mtk1">me</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk1">&nbsp;-&nbsp;start_time</span></span></div><div style="top:1843px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk8">#&nbsp;Обновляем&nbsp;прогресс&nbsp;каждые&nbsp;5%&nbsp;или&nbsp;каждые&nbsp;5&nbsp;секунд</span></span></div><div style="top:1862px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">if</span><span class="mtk1">&nbsp;</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">progress&nbsp;-&nbsp;</span><span class="mtk14 bracket-highlighting-1">(</span><span class="mtk1">downloaded_size_at_last_print&nbsp;/&nbsp;total_size&nbsp;*&nbsp;</span><span class="mtk6">100</span><span class="mtk1">&nbsp;</span><span class="mtk20">if</span><span class="mtk1">&nbsp;total_size&nbsp;&gt;&nbsp;</span><span class="mtk6">0</span><span class="mtk1">&nbsp;</span><span class="mtk20">else</span><span class="mtk1">&nbsp;</span><span class="mtk6">0</span><span class="mtk14 bracket-highlighting-1">)</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk1">&nbsp;&gt;=&nbsp;</span><span class="mtk6">5</span><span class="mtk1">&nbsp;</span><span class="mtk19">or</span><span class="mtk1">&nbsp;elapsed_time&nbsp;&gt;&nbsp;</span><span class="mtk6">5</span><span class="mtk14">:</span></span></div><div style="top:1881px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;Прогресс&nbsp;скачивания:&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">progress</span><span class="mtk6">:.1f</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">%&nbsp;(</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">downloaded_size&nbsp;/&nbsp;</span><span class="mtk14 bracket-highlighting-2">(</span><span class="mtk6">1024</span><span class="mtk1">*</span><span class="mtk6">1024</span><span class="mtk14 bracket-highlighting-2">)</span><span class="mtk6">:.1f</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">MB&nbsp;/&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">total_size&nbsp;/&nbsp;</span><span class="mtk14 bracket-highlighting-2">(</span><span class="mtk6">1024</span><span class="mtk1">*</span><span class="mtk6">1024</span><span class="mtk14 bracket-highlighting-2">)</span><span class="mtk6">:.1f</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">MB)"</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1900px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;downloaded_size_at</span><span class="mtk1">_last_print&nbsp;=&nbsp;downloaded_size</span></span></div><div style="top:1919px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_time&nbsp;=&nbsp;time.</span><span class="mtk1">time</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1938px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:1957px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_size&nbsp;=&nbsp;os.path.getsize</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">filename</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk1">&nbsp;/&nbsp;</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk6">1024</span><span class="mtk1">&nbsp;*&nbsp;</span><span class="mtk6">1024</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1976px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;Аудиофайл&nbsp;'</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">filename</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">'&nbsp;(</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">file_size</span><span class="mtk6">:.2f</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">&nbsp;MB)&nbsp;успешно&nbsp;скачан."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:1995px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span><span class="mtk1">&nbsp;filename</span></span></div><div style="top:2014px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">except</span><span class="mtk1">&nbsp;</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">requests.exceptions.RequestException</span><span class="mtk14">,</span><span class="mtk1">&nbsp;requests.exceptions.ChunkedEncodingError</span><span class="mtk14">,</span><span class="mtk1">&nbsp;ConnectionError</span><span class="mtk14">,</span><span class="mtk1">&nbsp;http.client.IncompleteRead</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk1">&nbsp;</span><span class="mtk20">as</span><span class="mtk1">&nbsp;e</span><span class="mtk14">:</span></span></div><div style="top:2033px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"[</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">task_id</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">]&nbsp;Ошибка&nbsp;скачивания&nbsp;(попытка&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">attempt&nbsp;+&nbsp;</span><span class="mtk6">1</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">):&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">e</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">.&nbsp;Повтор&nbsp;через&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">delay</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">&nbsp;сек..."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2052px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">if</span><span class="mtk1">&nbsp;attempt&nbsp;&lt;&nbsp;retries&nbsp;-&nbsp;</span><span class="mtk6">1</span><span class="mtk14">:</span></span></div><div style="top:2071px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.sleep</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">delay</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2090px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">else</span><span class="mtk14">:</span></span></div><div style="top:2109px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"[</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">task_id</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">]&nbsp;КРИТИЧЕСКАЯ&nbsp;ОШИБКА:&nbsp;Не&nbsp;удалось&nbsp;скачать&nbsp;аудиофайл&nbsp;</span><span class="mtk5">после&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">retries</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">&nbsp;попыток."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2128px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span><span class="mtk1">&nbsp;</span><span class="mtk9">None</span></span></div><div style="top:2147px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span><span class="mtk1">&nbsp;</span><span class="mtk9">None</span></span></div><div style="top:2166px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:2185px;height:19px;" class="view-line"><span><span class="mtk10">def</span><span class="mtk1">&nbsp;</span><span class="mtk17">upload_transcription_files</span><span class="mtk1 bracket-highlighting-0">(</span><span class="mtk4">task_id</span><span class="mtk1">,&nbsp;</span><span class="mtk4">file_paths</span><span class="mtk1">:&nbsp;</span><span class="mtk4">list</span><span class="mtk1 bracket-highlighting-0">)</span><span class="mtk14">:</span></span></div><div style="top:2204px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"--&gt;&nbsp;Этап&nbsp;5:&nbsp;Отправка&nbsp;файлов&nbsp;транскрипции&nbsp;на&nbsp;</span><span class="mtk5">сервер..."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2223px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">try</span><span class="mtk14">:</span></span></div><div style="top:2242px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;=&nbsp;</span><span class="mtk10">f</span><span class="mtk5">"</span><span class="mtk14 bracket-highlighting-0">{</span><span class="mtk1">SERVER_URL</span><span class="mtk14 bracket-highlighting-0">}</span><span class="mtk5">/api/colab/transcription/</span><span class="mtk14 bracket-highlighting-0">{</span><span class="mtk1">task_id</span><span class="mtk14 bracket-highlighting-0">}</span><span class="mtk5">"</span></span></div><div style="top:2261px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;files&nbsp;=&nbsp;</span><span class="mtk14 bracket-highlighting-0">[</span><span class="mtk14 bracket-highlighting-0">]</span></span></div><div style="top:2280px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">for</span><span class="mtk1">&nbsp;fp&nbsp;</span><span class="mtk19">in</span><span class="mtk1">&nbsp;file_paths</span><span class="mtk14">:</span></span></div><div style="top:2299px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_basename&nbsp;=&nbsp;os.path.basename</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">fp</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2318px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk8">#&nbsp;Определяем&nbsp;тип&nbsp;файла&nbsp;по&nbsp;расширению</span></span></div><div style="top:2337px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">if</span><span class="mtk1">&nbsp;fp.endswith</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">'.json'</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk14">:</span></span></div><div style="top:2356px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mime_type&nbsp;=&nbsp;</span><span class="mtk5">'application/json'</span></span></div><div style="top:2375px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">elif</span><span class="mtk1">&nbsp;fp.endswith</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">'.txt'</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk14">:</span></span></div><div style="top:2394px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mime_type&nbsp;=&nbsp;</span><span class="mtk5">'text/plain'</span></span></div><div style="top:2413px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">else</span><span class="mtk14">:</span></span></div><div style="top:2432px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mime_type&nbsp;=&nbsp;</span><span class="mtk5">'application/octet-stream'</span><span class="mtk1">&nbsp;</span><span class="mtk8">#&nbsp;Дефолтный&nbsp;тип</span></span></div><div style="top:2451px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:2470px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;files.append</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk14 bracket-highlighting-1">(</span><span class="mtk5">'transcription_files'</span><span class="mtk14">,</span><span class="mtk1">&nbsp;</span><span class="mtk14 bracket-highlighting-2">(</span><span class="mtk1">file_basename</span><span class="mtk14">,</span><span class="mtk1">&nbsp;</span><span class="mtk17">open</span><span class="mtk14 bracket-highlighting-3">(</span><span class="mtk1">fp</span><span class="mtk14">,</span><span class="mtk1">&nbsp;</span><span class="mtk5">'rb'</span><span class="mtk14 bracket-highlighting-3">)</span><span class="mtk14">,</span><span class="mtk1">&nbsp;mime_type</span><span class="mtk14 bracket-highlighting-2">)</span><span class="mtk14 bracket-highlighting-1">)</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2489px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:2508px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;Попытка&nbsp;отправки&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk17">len</span><span class="mtk14 bracket-highlighting-2">(</span><span class="mtk1">file_paths</span><span class="mtk14 bracket-highlighting-2">)</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">&nbsp;файлов&nbsp;на&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">url</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">&nbsp;..."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2527px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response&nbsp;=&nbsp;requests.post</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">url</span><span class="mtk14">,</span><span class="mtk1">&nbsp;files=files</span><span class="mtk14">,</span><span class="mtk1">&nbsp;timeout=</span><span class="mtk6">60</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2546px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.raise_for_status</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2565px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:2584px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;Файлы&nbsp;транскрипции&nbsp;успешно&nbsp;отправлены!"</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2603px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span><span class="mtk1">&nbsp;</span><span class="mtk9">True</span></span></div><div style="top:2622px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">except</span><span class="mtk1">&nbsp;Exception&nbsp;</span><span class="mtk20">as</span><span class="mtk1">&nbsp;e</span><span class="mtk14">:</span></span></div><div style="top:2641px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;ОШИБКА&nbsp;при&nbsp;отправке&nbsp;файлов&nbsp;транскрипции:&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">e</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">"</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2660px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span><span class="mtk1">&nbsp;</span><span class="mtk9">False</span></span></div><div style="top:2679px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">finally</span><span class="mtk14">:</span></span></div><div style="top:2698px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk8">#&nbsp;Закрываем&nbsp;все&nbsp;открытые&nbsp;файлы&nbsp;после&nbsp;отправки</span></span></div><div style="top:2717px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">for</span><span class="mtk1">&nbsp;_</span><span class="mtk14">,</span><span class="mtk1">&nbsp;</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">filename</span><span class="mtk14">,</span><span class="mtk1">&nbsp;file_obj</span><span class="mtk14">,</span><span class="mtk1">&nbsp;mime_type</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk1">&nbsp;</span><span class="mtk19">in</span><span class="mtk1">&nbsp;files</span><span class="mtk14">:</span></span></div><div style="top:2736px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file_obj.close</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2755px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:2774px;height:19px;" class="view-line"><span><span class="mtk10">def</span><span class="mtk1">&nbsp;</span><span class="mtk17">format_and_save_transcription_files</span><span class="mtk1 bracket-highlighting-0">(</span><span class="mtk4">task_id</span><span class="mtk1">,&nbsp;</span><span class="mtk4">result</span><span class="mtk1">,&nbsp;</span><span class="mtk4">original_filename</span><span class="mtk1 bracket-highlighting-0">)</span><span class="mtk14">:</span></span></div><div style="top:2793px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"--&gt;&nbsp;Этап&nbsp;4.1:&nbsp;Форматирование&nbsp;и&nbsp;сохранение&nbsp;</span><span class="mtk5">транскрипции..."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2812px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;base_name&nbsp;=&nbsp;os.path.splitext</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">original_filename</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk14 bracket-highlighting-0">[</span><span class="mtk6">0</span><span class="mtk14 bracket-highlighting-0">]</span></span></div><div style="top:2831px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:2850px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk8">#&nbsp;1.&nbsp;Сохраняем&nbsp;упрощенный&nbsp;формат&nbsp;(для&nbsp;AI)</span></span></div><div style="top:2869px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;simple_output_filename&nbsp;=&nbsp;</span><span class="mtk10">f</span><span class="mtk5">"</span><span class="mtk14 bracket-highlighting-0">{</span><span class="mtk1">base_name</span><span class="mtk14 bracket-highlighting-0">}</span><span class="mtk5">_simple.txt"</span></span></div><div style="top:2888px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">with</span><span class="mtk1">&nbsp;</span><span class="mtk17">open</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">simple_output_filename</span><span class="mtk14">,</span><span class="mtk1">&nbsp;</span><span class="mtk5">"w"</span><span class="mtk14">,</span><span class="mtk1">&nbsp;encoding=</span><span class="mtk5">"utf-8"</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk1">&nbsp;</span><span class="mtk20">as</span><span class="mtk1">&nbsp;f</span><span class="mtk14">:</span></span></div><div style="top:2907px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">for</span><span class="mtk1">&nbsp;segment&nbsp;</span><span class="mtk19">in</span><span class="mtk1">&nbsp;result</span><span class="mtk14 bracket-highlighting-0">[</span><span class="mtk5">"segments"</span><span class="mtk14 bracket-highlighting-0">]</span><span class="mtk14">:</span></span></div><div style="top:2926px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start</span><span class="mtk14">,</span><span class="mtk1">&nbsp;end</span><span class="mtk14">,</span><span class="mtk1">&nbsp;text&nbsp;=&nbsp;segment</span><span class="mtk14 bracket-highlighting-0">[</span><span class="mtk5">'start'</span><span class="mtk14 bracket-highlighting-0">]</span><span class="mtk14">,</span><span class="mtk1">&nbsp;segment</span><span class="mtk14 bracket-highlighting-0">[</span><span class="mtk5">'end'</span><span class="mtk14 bracket-highlighting-0">]</span><span class="mtk14">,</span><span class="mtk1">&nbsp;segment</span><span class="mtk14 bracket-highlighting-0">[</span><span class="mtk5">'text'</span><span class="mtk14 bracket-highlighting-0">]</span><span class="mtk1">.strip</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2945px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start_h</span><span class="mtk14">,</span><span class="mtk1">&nbsp;start_rem&nbsp;=&nbsp;</span><span class="mtk17">divmod</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">start</span><span class="mtk14">,</span><span class="mtk1">&nbsp;</span><span class="mtk6">3600</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk14">;</span><span class="mtk1">&nbsp;start_m</span><span class="mtk14">,</span><span class="mtk1">&nbsp;start_s&nbsp;=&nbsp;</span><span class="mtk17">divmod</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">start_rem</span><span class="mtk14">,</span><span class="mtk1">&nbsp;</span><span class="mtk6">60</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2964px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end_h</span><span class="mtk14">,</span><span class="mtk1">&nbsp;end_rem&nbsp;=&nbsp;</span><span class="mtk17">divmod</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">end</span><span class="mtk14">,</span><span class="mtk1">&nbsp;</span><span class="mtk6">3600</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk14">;</span><span class="mtk1">&nbsp;end_m</span><span class="mtk14">,</span><span class="mtk1">&nbsp;end_s&nbsp;=&nbsp;</span><span class="mtk17">divmod</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">end_rem</span><span class="mtk14">,</span><span class="mtk1">&nbsp;</span><span class="mtk6">60</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:2983px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time_str&nbsp;=&nbsp;</span><span class="mtk10">f</span><span class="mtk5">"[</span><span class="mtk14 bracket-highlighting-0">{</span><span class="mtk16">int</span><span class="mtk14 bracket-highlighting-1">(</span><span class="mtk1">start_h</span><span class="mtk14 bracket-highlighting-1">)</span><span class="mtk6">:02</span><span class="mtk14 bracket-highlighting-0">}</span><span class="mtk5">:</span><span class="mtk14 bracket-highlighting-0">{</span><span class="mtk16">int</span><span class="mtk14 bracket-highlighting-1">(</span><span class="mtk1">start_m</span><span class="mtk14 bracket-highlighting-1">)</span><span class="mtk6">:02</span><span class="mtk14 bracket-highlighting-0">}</span><span class="mtk5">:</span><span class="mtk14 bracket-highlighting-0">{</span><span class="mtk1">start_s</span><span class="mtk6">:06.3f</span><span class="mtk14 bracket-highlighting-0">}</span><span class="mtk5">&nbsp;-&nbsp;</span><span class="mtk14 bracket-highlighting-0">{</span><span class="mtk16">int</span><span class="mtk14 bracket-highlighting-1">(</span><span class="mtk1">end_h</span><span class="mtk14 bracket-highlighting-1">)</span><span class="mtk6">:02</span><span class="mtk14 bracket-highlighting-0">}</span><span class="mtk5">:</span><span class="mtk14 bracket-highlighting-0">{</span><span class="mtk16">int</span><span class="mtk14 bracket-highlighting-1">(</span><span class="mtk1">end_m</span><span class="mtk14 bracket-highlighting-1">)</span><span class="mtk6">:02</span><span class="mtk14 bracket-highlighting-0">}</span><span class="mtk5">:</span><span class="mtk14 bracket-highlighting-0">{</span><span class="mtk1">end_s</span><span class="mtk6">:06.3f</span><span class="mtk14 bracket-highlighting-0">}</span><span class="mtk5">]&nbsp;</span><span class="mtk14 bracket-highlighting-0">{</span><span class="mtk1">text</span><span class="mtk14 bracket-highlighting-0">}</span><span class="mtk5">"</span></span></div><div style="top:3002px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">time_str&nbsp;+&nbsp;</span><span class="mtk5">"\n"</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3021px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;Упрощенная&nbsp;транскрипция&nbsp;сохранена&nbsp;в:&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">simple_output_filename</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">"</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3040px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:3059px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk8">#&nbsp;2.&nbsp;Сохраняем&nbsp;детализированный&nbsp;JSON&nbsp;(для&nbsp;нарезки)</span></span></div><div style="top:3078px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;detailed_output_filename&nbsp;=&nbsp;</span><span class="mtk10">f</span><span class="mtk5">"</span><span class="mtk14 bracket-highlighting-0">{</span><span class="mtk1">base_name</span><span class="mtk14 bracket-highlighting-0">}</span><span class="mtk5">_detailed.json"</span></span></div><div style="top:3097px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">with</span><span class="mtk1">&nbsp;</span><span class="mtk17">open</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">detailed_output_filename</span><span class="mtk14">,</span><span class="mtk1">&nbsp;</span><span class="mtk5">"w"</span><span class="mtk14">,</span><span class="mtk1">&nbsp;encoding=</span><span class="mtk5">"utf-8"</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk1">&nbsp;</span><span class="mtk20">as</span><span class="mtk1">&nbsp;f</span><span class="mtk14">:</span></span></div><div style="top:3116px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json.dump</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">result</span><span class="mtk14">,</span><span class="mtk1">&nbsp;f</span><span class="mtk14">,</span><span class="mtk1">&nbsp;ensure_ascii=</span><span class="mtk9">False</span><span class="mtk14">,</span><span class="mtk1">&nbsp;indent=</span><span class="mtk6">4</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3135px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;Детализированная&nbsp;транскрипция&nbsp;сохранена&nbsp;в:&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">detailed_output_filename</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">"</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3154px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:3173px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span><span class="mtk1">&nbsp;</span><span class="mtk14 bracket-highlighting-0">[</span><span class="mtk1">simple_output_filename</span><span class="mtk14">,</span><span class="mtk1">&nbsp;detailed_output_filename</span><span class="mtk14 bracket-highlighting-0">]</span></span></div><div style="top:3192px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:3211px;height:19px;" class="view-line"><span><span class="mtk10">def</span><span class="mtk1">&nbsp;</span><span class="mtk17">run_one_task</span><span class="mtk1 bracket-highlighting-0">(</span><span class="mtk1 bracket-highlighting-0">)</span><span class="mtk14">:</span></span></div><div style="top:3230px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk5">"""Выполняет&nbsp;один&nbsp;полный&nbsp;цикл:&nbsp;поиск&nbsp;задачи,&nbsp;</span><span class="mtk5">транскрибация,&nbsp;отправка."""</span></span></div><div style="top:3249px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;model&nbsp;=&nbsp;setup_whisper</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3268px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">if</span><span class="mtk1">&nbsp;</span><span class="mtk19">not</span><span class="mtk1">&nbsp;model</span><span class="mtk14">:</span></span></div><div style="top:3287px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span></span></div><div style="top:3306px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:3325px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;task&nbsp;=&nbsp;get_task</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3344px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">if</span><span class="mtk1">&nbsp;</span><span class="mtk19">not</span><span class="mtk1">&nbsp;</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">task&nbsp;</span><span class="mtk19">and</span><span class="mtk1">&nbsp;task.get</span><span class="mtk14 bracket-highlighting-1">(</span><span class="mtk5">'success'</span><span class="mtk14 bracket-highlighting-1">)</span><span class="mtk14 bracket-highlighting-0">)</span><span class="mtk14">:</span></span></div><div style="top:3363px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"Завершение&nbsp;работы,&nbsp;так&nbsp;как&nbsp;нет&nbsp;доступных&nbsp;задач."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3382px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span></span></div><div style="top:3401px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:3420px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;task_id</span><span class="mtk14">,</span><span class="mtk1">&nbsp;audio_url</span><span class="mtk14">,</span><span class="mtk1">&nbsp;audio_filename&nbsp;=&nbsp;task</span><span class="mtk14 bracket-highlighting-0">[</span><span class="mtk5">'task_id'</span><span class="mtk14 bracket-highlighting-0">]</span><span class="mtk14">,</span><span class="mtk1">&nbsp;task</span><span class="mtk14 bracket-highlighting-0">[</span><span class="mtk5">'audio_url'</span><span class="mtk14 bracket-highlighting-0">]</span><span class="mtk14">,</span><span class="mtk1">&nbsp;task</span><span class="mtk14 bracket-highlighting-0">[</span><span class="mtk5">'audio_filename'</span><span class="mtk14 bracket-highlighting-0">]</span></span></div><div style="top:3439px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:3458px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;local_audio_path&nbsp;=&nbsp;download_audio</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">task_id</span><span class="mtk14">,</span><span class="mtk1">&nbsp;audio_url</span><span class="mtk14">,</span><span class="mtk1">&nbsp;audio_filename</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3477px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">if</span><span class="mtk1">&nbsp;</span><span class="mtk19">not</span><span class="mtk1">&nbsp;local_audio_path</span><span class="mtk14">:</span></span></div><div style="top:3496px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span></span></div><div style="top:3515px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:3534px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"--&gt;&nbsp;Этап&nbsp;4:&nbsp;Начало&nbsp;транскрибации&nbsp;для&nbsp;задачи&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">task_id</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">..."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3553px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">try</span><span class="mtk14">:</span></span></div><div style="top:3572px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;model.transcribe</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">local_audio_path</span><span class="mtk14">,</span><span class="mtk1">&nbsp;language=</span><span class="mtk5">"ru"</span><span class="mtk14">,</span><span class="mtk1">&nbsp;fp16=</span><span class="mtk9">False</span><span class="mtk14">,</span><span class="mtk1">&nbsp;verbose=</span><span class="mtk9">True</span><span class="mtk14">,</span><span class="mtk1">&nbsp;word_timestamps=</span><span class="mtk9">True</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3591px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;Транскрибация&nbsp;успешно&nbsp;завершена."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3610px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">except</span><span class="mtk1">&nbsp;Exception&nbsp;</span><span class="mtk20">as</span><span class="mtk1">&nbsp;e</span><span class="mtk14">:</span></span></div><div style="top:3629px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;КРИТИЧЕСКАЯ&nbsp;ОШИБКА&nbsp;во&nbsp;время&nbsp;транскрибации:&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">e</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">"</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3648px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">return</span></span></div><div style="top:3667px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:3686px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;transcription_file_paths&nbsp;=&nbsp;format_and_save_tra</span><span class="mtk1">nscription_files</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">task_id</span><span class="mtk14">,</span><span class="mtk1">&nbsp;result</span><span class="mtk14">,</span><span class="mtk1">&nbsp;audio_filename</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3705px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:3724px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;upload_success&nbsp;=&nbsp;upload_transcription_files</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">task_id</span><span class="mtk14">,</span><span class="mtk1">&nbsp;transcription_file_paths</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3743px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:3762px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">try</span><span class="mtk14">:</span></span></div><div style="top:3781px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.remove</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">local_audio_path</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3800px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">for</span><span class="mtk1">&nbsp;fp&nbsp;</span><span class="mtk19">in</span><span class="mtk1">&nbsp;transcription_file_paths</span><span class="mtk14">:</span></span></div><div style="top:3819px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.remove</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk1">fp</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3838px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"--&gt;&nbsp;Этап&nbsp;6:&nbsp;Временные&nbsp;файлы&nbsp;удалены."</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3857px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="mtk20">except</span><span class="mtk1">&nbsp;OSError&nbsp;</span><span class="mtk20">as</span><span class="mtk1">&nbsp;e</span><span class="mtk14">:</span></span></div><div style="top:3876px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk10">f</span><span class="mtk5">"&nbsp;&nbsp;&nbsp;&nbsp;ОШИБКА&nbsp;при&nbsp;удалении&nbsp;временных&nbsp;файлов:&nbsp;</span><span class="mtk14 bracket-highlighting-1">{</span><span class="mtk1">e</span><span class="mtk14 bracket-highlighting-1">}</span><span class="mtk5">"</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3895px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:3914px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;force_print</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk5">"===&nbsp;Цикл&nbsp;завершен&nbsp;==="</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3933px;height:19px;" class="view-line"><span><span></span></span></div><div style="top:3952px;height:19px;" class="view-line"><span><span class="mtk20">if</span><span class="mtk1">&nbsp;</span><span class="mtk4">__name__</span><span class="mtk1">&nbsp;==&nbsp;</span><span class="mtk5">"__main__"</span><span class="mtk14">:</span></span></div><div style="top:3971px;height:19px;" class="view-line"><span><span class="mtk1">&nbsp;&nbsp;&nbsp;&nbsp;run_one_task</span><span class="mtk14 bracket-highlighting-0">(</span><span class="mtk14 bracket-highlighting-0">)</span></span></div><div style="top:3990px;height:19px;" class="view-line"><span><span></span></span></div></div><div data-mprt="1" class="contentWidgets" style="position: absolute; top: 0px;"></div><div role="presentation" aria-hidden="true" class="cursors-layer cursor-line-style cursor-solid"><div class="cursor monaco-mouse-cursor-text " style="height: 19px; top: 0px; left: 0px; font-family: monospace, Consolas, &quot;Courier New&quot;, monospace; font-weight: normal; font-size: 14px; font-feature-settings: &quot;liga&quot; 0, &quot;calt&quot; 0; font-variation-settings: normal; line-height: 19px; letter-spacing: 0px; display: block; visibility: hidden; padding-left: 0px; width: 1.6px;"></div></div></div><div role="presentation" aria-hidden="true" class="visible scrollbar horizontal" style="position: absolute; width: 583px; height: 10px; left: 0px; bottom: 0px;"><div class="slider" style="position: absolute; top: 0px; left: 0px; height: 10px; transform: translate3d(0px, 0px, 0px); contain: strict; will-change: unset; width: 267px;"></div></div><canvas class="decorationsOverviewRuler" aria-hidden="true" width="17" height="5023" style="position: absolute; transform: translate3d(0px, 0px, 0px); contain: strict; top: 0px; right: 0px; width: 14px; height: 4019px; will-change: unset; display: block;"></canvas><div role="presentation" aria-hidden="true" class="invisible scrollbar vertical" style="position: absolute; width: 14px; height: 4019px; right: 0px; top: 0px;"><div class="slider" style="position: absolute; top: 0px; left: 0px; width: 14px; transform: translate3d(0px, 0px, 0px); contain: strict; will-change: unset; height: 4019px;"></div></div></div><div role="presentation" aria-hidden="true" style="width: 603px;"></div><textarea data-mprt="6" class="inputarea monaco-mouse-cursor-text" wrap="on" autocorrect="off" autocapitalize="off" autocomplete="off" spellcheck="false" aria-label="Editor content;Press Alt+F1 for Accessibility Options." tabindex="0" role="textbox" aria-roledescription="editor" aria-multiline="true" aria-haspopup="false" aria-autocomplete="both" style="tab-size: 15.3984px; font-family: monospace, Consolas, &quot;Courier New&quot;, monospace; font-weight: normal; font-size: 14px; font-feature-settings: &quot;liga&quot; 0, &quot;calt&quot; 0; font-variation-settings: normal; line-height: 19px; letter-spacing: 0px; top: 0px; left: 0px; width: 76992px; height: 1px;"></textarea><div class="monaco-editor-background textAreaCover" style="position: absolute; top: 0px; left: 0px; width: 76992px; height: 1px;"></div><div data-mprt="4" class="overlayWidgets" style="width: 603px;"><div widgetid="editor.contrib.quickInputWidget" style="position: absolute; top: 0px; right: 50%;"></div></div><div data-mprt="8" class="minimap slider-mouseover" role="presentation" aria-hidden="true" style="position: absolute; left: 0px; width: 0px; height: 4019px;"><div class="minimap-shadow-hidden" style="height: 4019px;"></div><canvas width="0" height="5023" style="position: absolute; left: 0px; width: 0px; height: 4019px;"></canvas><canvas class="minimap-decorations-layer" width="0" height="5023" style="position: absolute; left: 0px; width: 0px; height: 4019px;"></canvas><div class="minimap-slider" style="position: absolute; transform: translate3d(0px, 0px, 0px); contain: strict; width: 0px; will-change: unset;"><div class="minimap-slider-horizontal" style="position: absolute; width: 0px; height: 0px;"></div></div></div><div role="presentation" aria-hidden="true" class="blockDecorations-container"></div></div><div data-mprt="2" class="overflowingContentWidgets"><div widgetid="editor.contrib.resizableContentHoverWidget" style="position: fixed; height: 10px; width: 10px; z-index: 50; display: none; visibility: hidden; max-width: 1482px;"><div class="monaco-sash vertical" style="left: 8px;"></div><div class="monaco-sash vertical" style="left: -2px;"></div><div class="monaco-sash orthogonal-edge-north horizontal" style="top: -2px;"><div class="orthogonal-drag-handle start"></div><div class="orthogonal-drag-handle end"></div></div><div class="monaco-sash orthogonal-edge-south horizontal" style="top: 8px;"><div class="orthogonal-drag-handle start"></div><div class="orthogonal-drag-handle end"></div></div><div class="monaco-hover hidden" tabindex="0" role="tooltip"><div class="monaco-scrollable-element " role="presentation" style="position: relative; overflow: hidden;"><div class="monaco-hover-content" style="overflow: hidden; font-size: 14px; line-height: 1.35714; max-width: 500px; max-height: 1004.75px;"></div><div role="presentation" aria-hidden="true" class="invisible scrollbar horizontal" style="position: absolute;"><div class="slider" style="position: absolute; top: 0px; left: 0px; height: 10px; transform: translate3d(0px, 0px, 0px); contain: strict;"></div></div><div role="presentation" aria-hidden="true" class="invisible scrollbar vertical" style="position: absolute;"><div class="slider" style="position: absolute; top: 0px; left: 0px; width: 10px; transform: translate3d(0px, 0px, 0px); contain: strict;"></div></div><div class="shadow"></div><div class="shadow"></div><div class="shadow"></div></div></div></div></div><div class=".in-cell-overflowing"></div></div></div></div><colab-form class="formview vertical layout flex"><div class="widget-area vertical layout"></div></colab-form></div>
    <div class="output" aria-label="Выходные данные в ячейке 1" role="region"><!----> <div class="output-header"> </div>
        <div class="output-content">
          <div class="output-info"><colab-output-info class="output-toggle-enabled"></colab-output-info></div>
          <div class="output-iframe-container">
            <div class="output-iframe-sizer"> <div><div><colab-static-output-renderer role="group" tabindex="0"><div><div class="stream output_text"><pre>--&gt; Этап 1: Настройка Whisper...
    Установка зависимостей: openai-whisper, requests...
    Зависимости успешно установлены.
    Загрузка модели Whisper 'medium'...
</pre></div><div class="stream output_text"><pre>100%|█████████████████████████████████████| 1.42G/1.42G [00:18&lt;00:00, 83.7MiB/s]
</pre></div><div class="stream output_text"><pre>    Модель Whisper успешно загружена!
--&gt; Этап 2: Поиск задачи на сервере...
    Задача найдена!
[01e5fb06-a30e-4614-a7a2-175ecf3a6d25] Попытка скачивания #1/3 из <a rel="nofollow" target="_blank" href="http://52d06bb05cd3.ngrok-free.app/api/files/audio/%D0%A0%D0%B8%D0%BA%20%D0%B8%20%D0%9C%D0%BE%D1%80%D1%82%D0%B8_S07E04_720p.mp3">http://52d06bb05cd3.ngrok-free.app/api/files/audio/%D0%A0%D0%B8%D0%BA%20%D0%B8%20%D0%9C%D0%BE%D1%80%D1%82%D0%B8_S07E04_720p.mp3</a>...
    Прогресс скачивания: 1.4% (0.4MB / 31.0MB)
    Прогресс скачивания: 3.6% (1.1MB / 31.0MB)
    Прогресс скачивания: 5.1% (1.6MB / 31.0MB)
    Прогресс скачивания: 6.3% (1.9MB / 31.0MB)
    Прогресс скачивания: 8.5% (2.6MB / 31.0MB)
    Прогресс скачивания: 10.0% (3.1MB / 31.0MB)
    Прогресс скачивания: 11.4% (3.5MB / 31.0MB)
    Прогресс скачивания: 12.6% (3.9MB / 31.0MB)
    Прогресс скачивания: 14.7% (4.5MB / 31.0MB)
    Прогресс скачивания: 16.2% (5.0MB / 31.0MB)
    Прогресс скачивания: 17.6% (5.4MB / 31.0MB)
    Прогресс скачивания: 19.3% (6.0MB / 31.0MB)
    Прогресс скачивания: 20.7% (6.4MB / 31.0MB)
    Прогресс скачивания: 22.0% (6.8MB / 31.0MB)
    Прогресс скачивания: 23.4% (7.3MB / 31.0MB)
    Прогресс скачивания: 25.0% (7.7MB / 31.0MB)
    Прогресс скачивания: 26.1% (8.1MB / 31.0MB)
    Прогресс скачивания: 27.5% (8.5MB / 31.0MB)
    Прогресс скачивания: 29.2% (9.0MB / 31.0MB)
    Прогресс скачивания: 30.2% (9.4MB / 31.0MB)
    Прогресс скачивания: 32.3% (10.0MB / 31.0MB)
    Прогресс скачивания: 33.7% (10.4MB / 31.0MB)
    Прогресс скачивания: 35.0% (10.9MB / 31.0MB)
    Прогресс скачивания: 36.6% (11.3MB / 31.0MB)
    Прогресс скачивания: 37.9% (11.7MB / 31.0MB)
    Прогресс скачивания: 39.3% (12.2MB / 31.0MB)
    Прогресс скачивания: 40.9% (12.7MB / 31.0MB)
    Прогресс скачивания: 42.5% (13.2MB / 31.0MB)
    Прогресс скачивания: 43.7% (13.5MB / 31.0MB)
    Прогресс скачивания: 45.0% (13.9MB / 31.0MB)
    Прогресс скачивания: 46.4% (14.4MB / 31.0MB)
    Прогресс скачивания: 47.4% (14.7MB / 31.0MB)
    Прогресс скачивания: 48.4% (15.0MB / 31.0MB)
    Прогресс скачивания: 49.6% (15.4MB / 31.0MB)
    Прогресс скачивания: 51.1% (15.8MB / 31.0MB)
    Прогресс скачивания: 52.1% (16.1MB / 31.0MB)
    Прогресс скачивания: 53.5% (16.6MB / 31.0MB)
    Прогресс скачивания: 54.8% (17.0MB / 31.0MB)
    Прогресс скачивания: 56.6% (17.5MB / 31.0MB)
    Прогресс скачивания: 58.1% (18.0MB / 31.0MB)
    Прогресс скачивания: 59.3% (18.4MB / 31.0MB)
    Прогресс скачивания: 61.4% (19.0MB / 31.0MB)
    Прогресс скачивания: 62.7% (19.4MB / 31.0MB)
    Прогресс скачивания: 63.7% (19.7MB / 31.0MB)
    Прогресс скачивания: 65.3% (20.2MB / 31.0MB)
    Прогресс скачивания: 66.5% (20.6MB / 31.0MB)
    Прогресс скачивания: 67.9% (21.0MB / 31.0MB)
    Прогресс скачивания: 69.8% (21.6MB / 31.0MB)
    Прогресс скачивания: 71.3% (22.1MB / 31.0MB)
    Прогресс скачивания: 72.6% (22.5MB / 31.0MB)
    Прогресс скачивания: 74.1% (22.9MB / 31.0MB)
    Прогресс скачивания: 76.2% (23.6MB / 31.0MB)
    Прогресс скачивания: 77.5% (24.0MB / 31.0MB)
    Прогресс скачивания: 78.9% (24.4MB / 31.0MB)
    Прогресс скачивания: 80.1% (24.8MB / 31.0MB)
    Прогресс скачивания: 81.4% (25.2MB / 31.0MB)
    Прогресс скачивания: 82.8% (25.6MB / 31.0MB)
    Прогресс скачивания: 83.8% (25.9MB / 31.0MB)
    Прогресс скачивания: 84.7% (26.2MB / 31.0MB)
    Прогресс скачивания: 86.0% (26.6MB / 31.0MB)
    Прогресс скачивания: 87.4% (27.1MB / 31.0MB)
    Прогресс скачивания: 88.6% (27.4MB / 31.0MB)
    Прогресс скачивания: 90.1% (27.9MB / 31.0MB)
    Прогресс скачивания: 91.5% (28.4MB / 31.0MB)
    Прогресс скачивания: 92.4% (28.6MB / 31.0MB)
    Прогресс скачивания: 93.3% (28.9MB / 31.0MB)
    Прогресс скачивания: 94.4% (29.2MB / 31.0MB)
    Прогресс скачивания: 95.7% (29.6MB / 31.0MB)
    Прогресс скачивания: 97.0% (30.0MB / 31.0MB)
    Прогресс скачивания: 98.4% (30.5MB / 31.0MB)
    Аудиофайл 'Рик и Морти_S07E04_720p.mp3' (30.97 MB) успешно скачан.
--&gt; Этап 4: Начало транскрибации для задачи 01e5fb06-a30e-4614-a7a2-175ecf3a6d25...
[00:19.540 --&gt; 00:21.680]  Деда Рик, я и Модзи Черепа, только словами.
[00:21.760 --&gt; 00:24.260]  Соус? Ещё соуса? Подлива у нас что надо!
[00:24.340 --&gt; 00:25.840]  Пап, как прошло твое собеседование?
[00:26.460 --&gt; 00:29.340]  Фигово! Но пока есть баллоньеза, жить будем.
[00:29.540 --&gt; 00:29.980]  Боже, как я не могу.
[00:29.980 --&gt; 00:29.980]  Ну, что ж, я не могу.
[00:29.980 --&gt; 00:29.980]  Я не могу.
[00:29.980 --&gt; 00:29.980]  Я не могу.
[00:29.980 --&gt; 00:29.980]  Я не могу.
[00:29.980 --&gt; 00:29.980]  Я не могу.
[00:29.980 --&gt; 00:29.980]  Я не могу.
[00:29.980 --&gt; 00:29.980]  Я не могу.
[00:29.980 --&gt; 00:29.980]  Я не могу.
[00:29.980 --&gt; 00:29.980]  Я не могу.
[00:29.980 --&gt; 00:31.700]  Какое же нежное лапшо.
[00:31.920 --&gt; 00:35.000]  Немного остренькое, немного сладкое, немного остренькое, немного сладкое.
[21:14.720 --&gt; 21:15.800]  Как скажешь?
[21:16.080 --&gt; 21:19.840]  Серьезно, я не шучу. Я ничего не скажу, но вы должны знать, что правда кошмарно.
[21:20.380 --&gt; 21:22.900]  И если вы случайно узнаете, то меня винить не надо.
[21:23.660 --&gt; 21:24.140]  Заговорились?
[21:24.940 --&gt; 21:28.340]  Честно, вы бы самоубились, если бы знали. Больше ничего не скажу.
[21:57.420 --&gt; 21:58.820]  Ну-ка.
[22:06.800 --&gt; 22:08.000]  СПОКОЙНАЯ МУЗЫКА
[22:11.580 --&gt; 22:13.280]  СПОКОЙНАЯ МУЗЫКА
[22:16.760 --&gt; 22:19.820]  Так вот откуда берутся полисборники!
[22:20.080 --&gt; 22:21.200]  О, Господи!
[22:24.380 --&gt; 22:25.580]  ВЗРЫВ
[22:26.640 --&gt; 22:28.100]  О, Господи!
[22:28.760 --&gt; 22:29.680]  Ты нашел этого?
    Транскрибация успешно завершена.
--&gt; Этап 4.1: Форматирование и сохранение транскрипции...
    Упрощенная транскрипция сохранена в: Рик и Морти_S07E04_720p_simple.txt
    Детализированная транскрипция сохранена в: Рик и Морти_S07E04_720p_detailed.json
--&gt; Этап 5: Отправка файлов транскрипции на сервер...
    Попытка отправки 2 файлов на <a rel="nofollow" target="_blank" href="https://52d06bb05cd3.ngrok-free.app/api/colab/transcription/01e5fb06-a30e-4614-a7a2-175ecf3a6d25">https://52d06bb05cd3.ngrok-free.app/api/colab/transcription/01e5fb06-a30e-4614-a7a2-175ecf3a6d25</a> ...
    Файлы транскрипции успешно отправлены!
--&gt; Этап 6: Временные файлы удалены.
=== Цикл завершен ===
</pre></div></div><div></div></colab-static-output-renderer></div></div><div><div></div></div></div>
          </div>
        </div></div><colab-cell-next-steps></colab-cell-next-steps></div></div></div><div class="add-cell">
      <div class="add-cell-buttons">
        <md-outlined-button class="add-code add-button" data-aria-label="Добавить кодовую ячейку
Ctrl+M B" title="Добавить кодовую ячейку
Ctrl+M B" value="" has-icon="">
          <md-icon slot="icon" aria-hidden="true">add</md-icon>
          <!--?lit$678368646$-->Код
        </md-outlined-button>
        <md-outlined-button class="add-text add-button" data-aria-label="Добавить текстовую ячейку" title="Добавить текстовую ячейку" value="" has-icon="">
          <md-icon slot="icon" aria-hidden="true">add</md-icon>
          <!--?lit$678368646$-->Текст
        </md-outlined-button>
        <!--?lit$678368646$-->
        <!--?lit$678368646$-->
      </div><hr>
    </div></div>